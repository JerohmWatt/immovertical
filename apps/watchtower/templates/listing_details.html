<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè∞ {{ l.source_id }} | Immo-B√© Sentinel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .source-tag { @apply text-[10px] px-1.5 py-0.5 rounded-md font-black uppercase tracking-tighter ml-2; }
        .source-watcher { @apply bg-amber-100 text-amber-700 border border-amber-200; }
        .source-scraper { @apply bg-indigo-100 text-indigo-700 border border-indigo-200; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans selection:bg-indigo-100">
    <!-- Navbar -->
    <nav class="bg-slate-900 text-white p-4 shadow-xl sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <a href="/" class="text-xl font-bold tracking-tight flex items-center gap-3">
                <span class="bg-indigo-600 p-2 rounded-xl">üè∞</span>
                <span>IMMO-B√â <span class="font-light text-slate-400">Sentinel</span></span>
            </a>
            <div class="flex items-center space-x-6">
                <div class="hidden md:flex items-center space-x-2 text-xs">
                    <span class="w-2 h-2 rounded-full {% if l.is_scraped %}bg-green-500 animate-pulse{% else %}bg-amber-500{% endif %}"></span>
                    <span class="font-bold text-slate-300 uppercase">{{ l.status }}</span>
                </div>
                <a href="/all" class="text-sm bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-xl transition border border-slate-700 font-bold">
                    <i class="fa-solid fa-arrow-left mr-2"></i> Retour
                </a>
            </div>
        </div>
    </nav>

    <main class="container mx-auto p-4 md:p-8 max-w-7xl">
        
        <!-- Header Section -->
        <div class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4">
            <div>
                <div class="flex items-center gap-2 mb-2">
                    <span class="bg-slate-200 text-slate-700 px-3 py-1 rounded-lg text-xs font-black uppercase">{{ l.platform }}</span>
                    <span class="text-slate-400 text-xs font-mono">#{{ l.source_id }}</span>
                </div>
                <h1 class="text-3xl md:text-4xl font-black text-slate-900">
                    {{ l.property_type or "Bien Immobilier" }} 
                    <span class="font-light text-slate-400">√†</span> 
                    {{ l.city or "Localisation inconnue" }}
                </h1>
                <p class="text-slate-500 mt-2 flex items-center gap-2">
                    <i class="fa-solid fa-location-dot"></i>
                    {{ l.postal_code }} {{ l.city }} {% if l.country %}({{ l.country }}){% endif %}
                </p>
            </div>
            <div class="flex gap-3">
                <a href="{{ l.url }}" target="_blank" class="bg-white border-2 border-slate-200 hover:border-indigo-600 hover:text-indigo-600 p-4 rounded-2xl transition-all font-bold shadow-sm flex items-center gap-2">
                    <i class="fa-solid fa-external-link text-sm"></i> Annonce Originale
                </a>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            
            <!-- Left Column: Media & Content -->
            <div class="lg:col-span-8 space-y-8">
                
                <!-- Photo Gallery -->
                <div class="bg-white rounded-[2rem] shadow-sm border border-slate-200 overflow-hidden">
                    {% if l.images %}
                    <div class="relative aspect-video overflow-hidden">
                        <img src="{{ l.images[0] }}" alt="Primary" class="w-full h-full object-cover hover:scale-105 transition duration-700">
                        <div class="absolute top-6 left-6 flex gap-2">
                            <span class="bg-black/50 backdrop-blur-md text-white px-4 py-2 rounded-full text-xs font-bold">
                                <i class="fa-solid fa-camera mr-2"></i> {{ l.images|length }} photos
                            </span>
                        </div>
                    </div>
                    <div class="grid grid-cols-4 md:grid-cols-6 gap-3 p-4 bg-slate-50">
                        {% for img in l.images[1:13] %}
                        <div class="aspect-square rounded-xl overflow-hidden border border-slate-200">
                            <img src="{{ img }}" alt="Thumb" class="w-full h-full object-cover hover:opacity-80 transition cursor-zoom-in">
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="aspect-video bg-slate-100 flex flex-col items-center justify-center text-slate-400 gap-4">
                        <i class="fa-solid fa-image-slash text-5xl"></i>
                        <p class="font-bold italic text-sm text-slate-500 uppercase tracking-widest">En attente de moissonnage des images...</p>
                    </div>
                    {% endif %}
                </div>

                <!-- Main Characteristics Grid -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm flex flex-col items-center justify-center text-center group hover:border-indigo-300 transition">
                        <i class="fa-solid fa-maximize text-indigo-500 mb-2 text-xl"></i>
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Habitable</span>
                        <span class="text-xl font-black">{% if l.surface_habitable %}{{ l.surface_habitable }} m¬≤{% else %}N/C{% endif %}</span>
                        <span class="source-tag source-scraper">Scrap</span>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm flex flex-col items-center justify-center text-center group hover:border-indigo-300 transition">
                        <i class="fa-solid fa-tree text-green-500 mb-2 text-xl"></i>
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Terrain</span>
                        <span class="text-xl font-black">{% if l.surface_terrain %}{{ l.surface_terrain }} m¬≤{% else %}N/C{% endif %}</span>
                        <span class="source-tag source-scraper">Scrap</span>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm flex flex-col items-center justify-center text-center group hover:border-indigo-300 transition">
                        <i class="fa-solid fa-bed text-blue-500 mb-2 text-xl"></i>
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Chambres</span>
                        <span class="text-xl font-black">{% if l.rooms %}{{ l.rooms }}{% else %}N/C{% endif %}</span>
                        <span class="source-tag source-scraper">Scrap</span>
                    </div>
                    <div class="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm flex flex-col items-center justify-center text-center group hover:border-indigo-300 transition">
                        <i class="fa-solid fa-bath text-cyan-500 mb-2 text-xl"></i>
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Bains</span>
                        <span class="text-xl font-black">{% if l.bathrooms %}{{ l.bathrooms }}{% else %}N/C{% endif %}</span>
                        <span class="source-tag source-scraper">Scrap</span>
                    </div>
                </div>

                <!-- Description -->
                <div class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-sm border border-slate-200">
                    <h2 class="text-2xl font-black text-slate-900 mb-6 flex items-center gap-3">
                        <i class="fa-solid fa-align-left text-indigo-600"></i>
                        Description du bien
                        <span class="source-tag source-scraper">Scraper</span>
                    </h2>
                    <div class="text-slate-600 leading-relaxed text-lg whitespace-pre-line font-light">
                        {{ l.description or "Le moissonneur n'a pas encore extrait la description." }}
                    </div>
                </div>

                <!-- Technical Details -->
                <div class="bg-white p-8 md:p-12 rounded-[2.5rem] shadow-sm border border-slate-200">
                    <h2 class="text-2xl font-black text-slate-900 mb-8 flex items-center gap-3 border-b pb-4">
                        <i class="fa-solid fa-info-circle text-indigo-600"></i>
                        D√©tails Techniques
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-6">
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">Type de bien</span>
                            <span class="font-bold text-slate-900 uppercase tracking-tight">{{ l.property_type or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">Sous-type</span>
                            <span class="font-bold text-slate-900 uppercase tracking-tight">{{ l.property_subtype or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">Nombre de fa√ßades</span>
                            <span class="font-bold text-slate-900">{{ l.facades or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">Ann√©e de construction</span>
                            <span class="font-bold text-slate-900">{{ l.construction_year or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">√âtat du b√¢timent</span>
                            <span class="font-bold text-slate-900 uppercase tracking-tighter">{{ l.condition or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">Cuisine</span>
                            <span class="font-bold text-slate-900 uppercase tracking-tighter">{{ l.kitchen_type or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">Pi√®ces totales</span>
                            <span class="font-bold text-slate-900">{{ l.room_count or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">Toilettes</span>
                            <span class="font-bold text-slate-900">{{ l.toilet_count or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">√âtage</span>
                            <span class="font-bold text-slate-900">{{ l.floor or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">Jardin</span>
                            <span class="font-bold text-slate-900">{% if l.garden_surface %}{{ l.garden_surface }} m¬≤{% else %}Non{% endif %}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">Terrasse</span>
                            <span class="font-bold text-slate-900">{% if l.terrace_surface %}{{ l.terrace_surface }} m¬≤{% else %}Non{% endif %}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">R√©nov√© en</span>
                            <span class="font-bold text-slate-900">{{ l.renovation_year or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">Chauffage</span>
                            <span class="font-bold text-slate-900 uppercase tracking-tighter">{{ l.heating_type or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center py-3 border-b border-slate-100">
                            <span class="text-slate-500 font-medium">Meubl√©</span>
                            <span class="font-bold text-slate-900 uppercase tracking-tighter">{{ "Oui" if l.is_furnished else "Non" }}</span>
                        </div>
                    </div>
                </div>

                <!-- Expert View: Raw JSON -->
                <details class="bg-slate-900 rounded-[2.5rem] shadow-2xl overflow-hidden group">
                    <summary class="p-8 text-white font-black text-xl cursor-pointer list-none flex items-center justify-between group-open:bg-slate-800 transition-colors">
                        <div class="flex items-center gap-4">
                            <i class="fa-solid fa-code text-indigo-400"></i>
                            DONN√âES BRUTES (JSON CLASSIFIED)
                        </div>
                        <i class="fa-solid fa-chevron-down text-sm transition-transform group-open:rotate-180"></i>
                    </summary>
                    <div class="p-8 bg-slate-950 border-t border-slate-800">
                        <pre class="text-indigo-400 text-[10px] leading-relaxed overflow-x-auto selection:bg-indigo-900">{{ l.raw_data | tojson(indent=2) }}</pre>
                    </div>
                </details>
            </div>

            <!-- Right Column: Finance & Sidebar -->
            <div class="lg:col-span-4 space-y-6 lg:sticky lg:top-24 self-start">
                
                <!-- Financial Card -->
                <div class="bg-indigo-600 text-white p-8 md:p-10 rounded-[2.5rem] shadow-2xl shadow-indigo-200 space-y-6">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="text-indigo-200 text-[10px] font-black uppercase tracking-[0.2em] mb-1">Prix de pr√©sentation</p>
                            <h3 class="text-5xl font-black tracking-tighter">
                                {% if l.price %}{{ "{:,.0f}".format(l.price).replace(',', ' ') }}<span class="text-2xl ml-1 text-indigo-300">‚Ç¨</span>{% else %}N/C{% endif %}
                            </h3>
                        </div>
                        <div class="bg-white/10 p-4 rounded-2xl backdrop-blur-xl">
                            <i class="fa-solid fa-wallet text-2xl text-white"></i>
                        </div>
                    </div>

                    {% if l.is_viager %}
                    <div class="bg-white/10 p-6 rounded-3xl border border-white/10 space-y-4">
                        <div class="flex items-center gap-2 text-indigo-100 font-bold text-xs uppercase tracking-widest">
                            <i class="fa-solid fa-hourglass-half"></i> Conditions Viager
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-indigo-200 text-sm">Bouquet</span>
                            <span class="font-black text-lg text-white">{% if l.annuity_bouquet %}{{ "{:,.0f}".format(l.annuity_bouquet).replace(',', ' ') }} ‚Ç¨{% else %}N/C{% endif %}</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-indigo-200 text-sm">Rente/mois</span>
                            <span class="font-black text-lg text-white text-orange-300">{% if l.annuity_monthly %}{{ "{:,.0f}".format(l.annuity_monthly).replace(',', ' ') }} ‚Ç¨{% else %}N/C{% endif %}</span>
                        </div>
                    </div>
                    {% endif %}

                    <div class="space-y-4 pt-4 border-t border-white/10">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-indigo-200">Revenu Cadastral</span>
                            <span class="font-bold">{% if l.cadastral_income %}{{ l.cadastral_income }} ‚Ç¨{% else %}N/C{% endif %}</span>
                        </div>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-indigo-200">Vente Publique</span>
                            <span class="font-bold uppercase tracking-widest text-[10px] px-2 py-1 rounded {% if l.is_public_sale %}bg-amber-500 text-white{% else %}text-indigo-300{% endif %}">
                                {{ "Oui" if l.is_public_sale else "Non" }}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Energy Performance Card -->
                <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm space-y-6">
                    <h4 class="text-sm font-black text-slate-900 uppercase tracking-widest flex items-center gap-2">
                        <i class="fa-solid fa-bolt text-yellow-500"></i> Performance √ânerg√©tique
                    </h4>
                    
                    {% set label = l.energy_class or "N/C" %}
                    <div class="flex items-center justify-between p-4 rounded-3xl 
                        {% if label == 'A' %}bg-green-50 text-green-700{% elif label == 'B' %}bg-green-50 text-green-600{% elif label == 'C' %}bg-lime-50 text-lime-600{% elif label == 'D' %}bg-yellow-50 text-yellow-600{% elif label == 'E' %}bg-orange-50 text-orange-600{% elif label == 'F' %}bg-red-50 text-red-600{% elif label == 'G' %}bg-red-100 text-red-800{% else %}bg-slate-50 text-slate-400{% endif %}">
                        <div class="flex flex-col">
                            <span class="text-[10px] font-black uppercase tracking-widest opacity-60">Label PEB</span>
                            <span class="text-3xl font-black">{{ label }}</span>
                        </div>
                        <div class="text-4xl">
                            <i class="fa-solid fa-leaf"></i>
                        </div>
                    </div>
                    
                    {% if l.epc_score %}
                    <div class="p-6 bg-slate-50 rounded-3xl border border-slate-100">
                        <div class="flex justify-between items-end mb-2">
                            <span class="text-xs text-slate-500 font-bold uppercase tracking-tighter">Consommation sp√©cifique</span>
                            <span class="font-black text-slate-900 text-lg">{{ l.epc_score }} <span class="text-[10px] font-bold text-slate-400">kWh/m¬≤.an</span></span>
                        </div>
                        <div class="w-full h-2 bg-slate-200 rounded-full overflow-hidden">
                            <div class="h-full bg-indigo-500 rounded-full" style="width: {{ (l.epc_score / 12) if l.epc_score < 1200 else 100 }}%"></div>
                        </div>
                    </div>
                    {% endif %}

                    <div class="space-y-2 pt-4 border-t border-slate-100">
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-slate-500">R√©f√©rence PEB</span>
                            <span class="font-mono text-slate-700">{{ l.epc_reference or "N/C" }}</span>
                        </div>
                        <div class="flex justify-between items-center text-xs">
                            <span class="text-slate-500">√âmissions CO2</span>
                            <span class="font-bold text-slate-700">{% if l.co2_emissions %}{{ l.co2_emissions }} kg CO2/m¬≤.an{% else %}N/C{% endif %}</span>
                        </div>
                    </div>
                </div>

                <!-- Geo Card -->
                <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm space-y-4">
                    <h4 class="text-sm font-black text-slate-900 uppercase tracking-widest flex items-center gap-2">
                        <i class="fa-solid fa-map-location-dot text-indigo-500"></i> G√©o-Position
                    </h4>
                    {% if l.latitude and l.longitude %}
                    <div class="aspect-square rounded-3xl bg-slate-100 overflow-hidden relative group">
                        <!-- Placeholder for a real map or static map image -->
                        <div class="absolute inset-0 flex items-center justify-center bg-indigo-50 text-indigo-200 group-hover:text-indigo-400 transition">
                            <i class="fa-solid fa-map text-5xl"></i>
                        </div>
                        <a href="https://www.google.com/maps?q={{ l.latitude }},{{ l.longitude }}" target="_blank" class="absolute inset-0 bg-black/0 hover:bg-black/20 transition flex items-center justify-center text-white opacity-0 hover:opacity-100 font-bold">
                            <span class="bg-indigo-600 px-4 py-2 rounded-xl shadow-lg">Ouvrir Google Maps</span>
                        </a>
                    </div>
                    <div class="grid grid-cols-2 gap-2 text-[10px] font-mono text-slate-400">
                        <span>LAT: {{ l.latitude }}</span>
                        <span>LNG: {{ l.longitude }}</span>
                    </div>
                    {% else %}
                    <div class="p-8 text-center text-slate-400 italic text-xs bg-slate-50 rounded-3xl border border-dashed border-slate-200">
                        Coordonn√©es GPS non extraites.
                    </div>
                    {% endif %}
                </div>

            </div>
        </div>
    </main>

    <footer class="container mx-auto p-12 text-center border-t border-slate-200 mt-12 space-y-4">
        <div class="text-2xl font-black text-slate-200 tracking-widest italic">IMMO-B√â SENTINEL</div>
        <p class="text-slate-400 text-[10px] uppercase font-black tracking-[0.3em]">Truth Engine ‚Ä¢ Audited Property Database</p>
    </footer>

    <script>
        // Simple zoom effect for thumbnails
        document.querySelectorAll('img[alt="Thumb"]').forEach(img => {
            img.onclick = () => {
                const main = document.querySelector('img[alt="Primary"]');
                const oldMain = main.src;
                main.src = img.src;
                img.src = oldMain;
            };
        });
    </script>
</body>
</html>
